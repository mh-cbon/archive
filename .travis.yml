sudo: required

services:
  - docker

language: go
go:
  - tip

env:
  global:
    - MYAPP=archive
    - MYEMAIL=mh-cbon@users.noreply.github.com
    - secure: ubejYl/jcRBoerK/Bs+3pUnWUOonhspopzh3I0rSuvDyqfRtorFfIzehrJjsj4ZTNWofNgf4LIg9xsvCU1wxdzLIR+MH1eG3DwzSK4p/gbbVp0C7WtZlRwne43LusKRliDXm/IoIQWRtFKze7N6+QsEf+rQV12fZWG8j5s9nKDFT+hg6vQkihwiuZF5mv3hdt/HoZZNy9bDmflm9F/sXrW8k+eB+Y3/LtoS/Og0Oaq0nzIxxQwtQItYcE9d68Wr0gFgHWDvOmbee72puSPPXuMF7kokhDPJP+yMJ978hOIkmykClXylBJxtrvMxJHeHZjPoDHMRT7ke3tDwSs/JVeBC45IpLlpU8jx3YqQ0JGnQ/YUe3SjDbSTro4ULrRcj1estQGyxDWZNt08Qs4IdldgtRqSfY4/eGIfJpwrYa3TE47WT2Qd9/jYGUTNR01R19f5Hhlwkr6+eCXMNAZoo2cxRQqIpHxUTJByYzwOWANm5WeeaVbhnGBpx8OaBMwnE4O8DUTUNt90WB377IioFWC/CVIpCWty7GM8Elk7VRW//VGjl0U8mwho82gRiW6FBTIjXFgAAB0F6ltVUR1BX6WeBZlHpID6yIJBI4roZjw4o9QAvZru4ViMopiQp2H5X7T8gh03oh04n23Z/VN80Ql+/q723lXBu1DUCj4WcHHKY=

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin
  - cd ~
  - curl https://glide.sh/get | sh

install:
  - cd $GOPATH/src/github.com/mh-cbon/$MYAPP
  - glide install
  - go install

script: echo "pass"

before_deploy:
  - mkdir -p build/{386,amd64}
  - mkdir -p pkg-build/{386,amd64}
  - GOOS=linux GOARCH=386 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/386/$MYAPP main.go
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/amd64/$MYAPP main.go
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/create-pkg.sh | GH=mh-cbon/$MYAPP sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/create-pkg.sh | GH=mh-cbon/$MYAPP sh -xe

after_deploy:
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/setup-repository.sh | GH=mh-cbon/$MYAPP EMAIL=$MYEMAIL sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/setup-repository.sh | GH=mh-cbon/$MYAPP EMAIL=$MYEMAIL sh -xe

deploy:
  provider: releases
  api_key:
    secure: hK0IDXrVsDJGzTH6vVm6/FCK7t9lKo2IZLcUvi8BxijheSeTKO6uvcZgGDniJkQSZceDqMQ7c9LuxOjUE6zXjgR9dGmPp09W4R/CNcF0LNUQ7RIzJkUWBaKby383EHa/B08saJIjtbWZffQ2qOLSnZ05oYq5Os1uS+HsufBQTm9R9+x+2ydp66L6qy6YkFm7FnajixXlHyU/GjTg3ifOAZiiqDVfC1/gPR3RgMiGzdcrJmobtu+9W1ttdJqTnxFnmawA0pUT7/M3Cw7x2alD+yjpAlkZuftfTwwBR3TpDvnVyLry1foeb8xNH9FKhP0If2n4cjIPWrZgD7HiGo0JsljzCP24oIyFplda8v6xJCmzaR7hZiEOD7OAAE94YTESg8XGweN0PCdsPEBZ0vGHsb0/yVysKp6c2G2MBrTdnGOcgajpPaVnGkgaTRM4PwtKpFgyUI7VDhxCjBOvbgj18eZJssstAaXZjHD8kiDm/03B2Xs+FqT4lkCuTK4htWdD3/J7ABhvY8SqMLlEivt1nHhSPVRaox4pmktSaSwHndelZu1tVRV8g1zYP6liFSTCjQS3lqONRaPI2AHTjZaFsoXgk/gglSrCVZNK0+awEPz8dDU32iyqKta1uERtQJKuEBESwFOnSHq3RCfoH8LqaYoLVEw/DaNZl3hjVQi6JzQ=
  file_glob: true
  file:
    - $MYAPP-386.deb
    - $MYAPP-amd64.deb
    - $MYAPP-386.rpm
    - $MYAPP-amd64.rpm
  skip_cleanup: true
  on:
    tags: true
